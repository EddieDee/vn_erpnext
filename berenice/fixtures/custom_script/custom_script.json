[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2018-10-25 13:01:32.146704", 
  "name": "Purchase Invoice-Client", 
  "script": "const taxid = function (){\nif(cur_frm.doc.supplier && !cur_frm.doc.tax_id){\nfrappe.call({\n                                               method: 'frappe.client.get_value',\n                                               freeze: true,\n                                               args: {\n                                                   'doctype': 'Supplier',\n                                                   'filters': {'name': cur_frm.doc.supplier},\n                                                   'fieldname': [\n                                                    'tax_id',\n                                                   ]\n                                               },\n                                               callback: function(r) {\n                                                   if (!r.exc) {\n            \n                                               var tax_id = r.message.tax_id;\nconsole.log(tax_id);\n\t\t\t\t\t\t//return tax_id;\n           \n                                                   cur_frm.set_value('tax_id',tax_id);\n            \n                                                  }\n                                           }\n                                           });\n}\n}\n\nfrappe.ui.form.on(\"Purchase Invoice\", {\nrefresh : function(){\nconsole.log('actualizado!!');\ntaxid();\n},\nsupplier: function (frm) {\n\nconsole.log(taxid());\nconsole.log('supplier loaded: '+frm.doc.supplier+'-');\n}\n});\n\nfrappe.ui.form.on(\"Purchase Invoice\", {\nbefore_cancel: function(frm) {\nif(frm.doc.docstatus==1 && !frm.timeline.get_communications().length){\n//frappe.validated = false;\nfrappe.throw(__(\"Please Comment before Cancel\"));\n}\n},\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2018-11-15 17:33:45.894418", 
  "name": "Customer-Client", 
  "script": "frappe.ui.form.on(\"Customer\", {\ncustomer_type: function(frm) {\nfrm.set_df_property(\"tax_id\", \"reqd\", \"Businesses\"|| \"Government Entities\" || \"Non-profit Organizations\" ? 1 : 0);\nif(frm.doc.customer_type==\"Final Clients\"){\nfrm.set_value('tax_id', '');\nfrm.set_df_property(\"tax_id\", \"reqd\", \"Final Clients\" ? 0 : 1);\nconsole.log(\"Cambio: \"+ cur_frm.doc.customer_type);\n} else if (frappe.quick_entry){\nif(frappe.quick_entry.doc.customer_type == \"Final Clients\"){\nconsole.log(\"Cambio a: \"+ frappe.quick_entry.doc.customer_type);\nfrappe.quick_entry.set_value('tax_id', '');\nfrappe.quick_entry.set_df_property(\"tax_id\", \"reqd\", \"Final Clients\" ? 0 : 1);\n}\n}\n\nconsole.log(\"Set: \"+ frm.doc.customer_type );\nconsole.log(\"Set NCF: \"+ cur_dialog.doc.tax_id );\n}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2018-08-24 09:40:30.102426", 
  "name": "Stock Entry-Client", 
  "script": "frappe.ui.form.on(\"Stock Entry Detail\", {\n\titem_code: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\t\tvar tax = 0;\n\t\tme.frm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Tax\",\n\t\t\t\tfieldname: \"tax_rate\",\n\t\t\t\tfilters: { item_code: child.item_code},\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tconsole.log(r.message);\n\t}\n\t\t\t}\n\t\t});\n\n\n\n\t\tme.frm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Price\",\n\t\t\t\tfieldname: \"price_list_rate\",\n\t\t\t\tfilters: { item_code: child.item_code, price_list : frm.doc.selling_price_list},\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"price_list_rate\", r.message.price_list_rate*1.18);\n\ncur_frm.doc.items[0];\n/*console.log(child.tax_rate)*/\n\t}\n\t\t\t}\n\t\t});\n\t}\n});\n\n\n/*frappe.ui.form.on(\"Stock Entry Detail\", {\nitem_code: function(frm, cdt, cdn) {\n\t\tchild = locals[cdt][cdn];\n\t\tme.frm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Item Price\",\n\t\t\t\tfieldname: \"price_list_rate\",\n\t\t\t\tfilters: { item_code: item_code, price_list : 'Standard Buying'},\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'basic_rate', r.message.price_list_rate);\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\t\n});*/", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2018-06-01 12:05:06.632205", 
  "name": "Item-Client", 
  "script": "/*frappe.ui.form.on(\"Item\", \"refresh\", function(frm, cdt, cdn){\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Stock Ledger Entry\",\n\t\t\t\t\tfieldname: \"valuation_rate\",\n\t\t\t\t\tfilters: { item_code: cur_frm.doc.item_code},\n\t\t\t\t      },\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message){\n\t\t\t\t\t\tconsole.log(r.message.valuation_rate);\n\t\t\t\t\t\tcur_frm.set_value('latest_cost', r.message.valuation_rate);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t});\n\t});\n\n\n*/", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-11-16 09:56:45.539131", 
  "name": "Sales Invoice-Client", 
  "script": "/* CUSTOM FUNCTION */\n\nconst isg_ncf= function(){\nlet value = arguments[0];\nconsole.log(value +' << checkbox on'+arguments[0]);\nif (arguments[0]){\nconsole.log(value+' << ncf checked'); \n$(\"input[data-fieldname=g_ncf]\").prop('checked', value);\ncur_frm.set_value('generate_ncf', value);\nconsole.log('Arg-->'+arguments.length+' Checked--> '+value);\n}else{\nlet res=$(\"input[data-fieldname=g_ncf]\").prop(\"checked\") | 0;\n$(\"input[data-fieldname=g_ncf]\").prop('checked', value);\nconsole.log(' Checked--> '+res);\nreturn res;\n}\n}\nfunction imprimir(){\nconsole.log('pagando con CC');\n}\n\nfunction check_cc(){\ntry{\n\tlet cc = cur_frm.doc.payments[2].amount;\n\tconsole.log(cc);\n\tif(cc){\n\t\tisg_ncf(1);\n\t\tconsole.log('pagando con CC'+cur_frm.doc.payments[2].amount);\n\t}else{\n\t\tconsole.log('No fue con tarjeta: ');\n}\n}catch(err){\n\tconsole.log('Houston we have a problem,No fue con tarjeta: : '+err);\n}\n}\n\nfrappe.ui.form.on('Sales Invoice', { \n\n   refresh: function(frm){\n    console.log(\"Refreshed\");\n},\n\nbefore_cancel: function(frm) {\n if(frm.doc.docstatus==1 && !frm.timeline.get_communications().length){\nfrappe.throw(__(\"Please Comment before Cancel\"));\nfrappe.validated = false; \n} \n},\nbefore_save: function(frm){\ncur_frm.add_fetch('Customer', 'customer_type', 'customer_type');\ncur_frm.add_fetch('Customer', 'tax_id', 'tax_id');\ncheck_cc();\n\n},\nafter_cancel: function(frm){\nconsole.log(\"Cancelled\");\ncur_frm.set_value('generate_ncf',0);\n},\n\nonload: function(frm){\nif(frappe.pages['point-of-sale']){\nconsole.log('Billing from POS on ');\n\n$(\"div[data-fieldname=g_ncf]\").remove();\nfrm.script_manager.trigger('customer');\nconst g_ncf = frappe.ui.form.make_control({\n                df: {\n                    fieldname: 'g_ncf',\n                    fieldtype: 'Check',\n                    label: __('Comprobante Fiscal'),\n\t\n\t\tonchange: () => {\n\t\t\t\tlet current_value=isg_ncf();\n\t\t\t\tconsole.log(isg_ncf()+' Current value');\n\t\t\t\tcur_frm.set_value(\"generate_ncf\",current_value);\n\t\t\t\tconsole.log('sweetxxx-'+cur_frm.doc.generate_ncf);\n\t\t\t\tisg_ncf(current_value);\n\t\t\t\t}\n                },\n                parent: $('.customer-field'),\n                render_input: true,\n            });\n\n}\n// if doc is local set g_ncf to read only \n// if doc is returned set g_ncf to read only and update ncf form return against\n\n \t\tif(frm.doc.is_return==1) {\n \t\t\t/*Auto fetch ncf for the first sales invoice and make generate ncf read only in case of return */\n\t\t    \tcur_frm.set_value(\"generate_ncf\",0);\n \t\t    \tcur_frm.set_df_property(\"generate_ncf\", \"read_only\",true);\n \t\t    \tcur_frm.add_fetch('return_against', 'ncf', 'ncf');\n \t    \t\tcur_frm.refresh_field(\"ncf\");\n \t\t\t//cur_frm.refresh_fields();\n  \t\t}\n},\n\ncustomer:function(frm){\n    var customer = cur_frm.doc.customer;\n                 if(customer){\n                                   frappe.call({\n                                               method: 'frappe.client.get_value',\n                                               freeze: true,\n                                               args: {\n                                                   'doctype': 'Customer',\n                                                   'filters': {'name': customer},\n                                                   'fieldname': [\n                                                    'customer_type',\n\t\t\t\t\t\t    'tax_id'\n                                                   ]\n                                               },\n                                               callback: function(r) {\n                                                   if (!r.exc) {\n            \t\t\t\t\tconsole.log(r.message);\n                                               var response_cus_type = r.message.customer_type;\n\t\t\t\t\t\tlet tax_id = r.message.tax_id;\n\t\t\t\t\t\tlet customer_type = r.message.customer_type;\n            \t\t\t\t\tcur_frm.set_value('tax_id',tax_id);\n\t\t\t\t\t\tcur_frm.set_value('customer_type',customer_type);\n                                               if(response_cus_type=='Final Clients'){\n                                                frm.set_value('generate_ncf',0);\n\t\t\t\t\t\tisg_ncf(0);\n\t\t\t\tconsole.log(frm.doc.generate_ncf+'<-> '+$(\"input[data-fieldname=g_ncf]\").val() );\n\t\t\t\t\t\t\n                                                   }else if (response_cus_type=='Businesses'||response_cus_type=='Government Entities'){\n                                                  // cur_frm.set_value('generate_ncf',1);\n//cur_frm.set_df_property(\"generate_ncf\", \"read_only\",true);\nisg_ncf(1);\n//console.log(frm.doc.generate_ncf+'<-> '+$(\"input[data-fieldname=g_ncf]\").val() );\n            \n                                                   }\n                                               }\n                                           }\n});\n}\n},\n});\n", 
  "script_type": "Client"
 }
]